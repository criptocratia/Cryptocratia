<!doctype html><html lang=en-en dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width"><link rel=icon type=image/ico href=https://criptocratia.github.io/Cryptocratia//favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://criptocratia.github.io/Cryptocratia//favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://criptocratia.github.io/Cryptocratia//favicon-32x32.png><link rel=icon type=image/png sizes=192x192 href=https://criptocratia.github.io/Cryptocratia//android-chrome-192x192.png><link rel=apple-touch-icon sizes=180x180 href=https://criptocratia.github.io/Cryptocratia//apple-touch-icon.png><meta name=description content><title>PKCS#11 – Detalii Tehnice | Cryptocrația
</title><link rel=canonical href=https://criptocratia.github.io/Cryptocratia/2024/08/pkcs%2311-detalii-tehnice/><link rel=stylesheet href=/Cryptocratia/assets/combined.min.d401b67cac16221b4778481ad3277f3826dbec2cb0811c2d7f16b50478a1cd02.css media=all></head><body class=auto><div class=content><header><div class=header><h1 class=header-title>Cryptocrația</h1><div class=flex><p class=small><a href=/Cryptocratia/>/Prima Pagină</a></p><p class=small><a href=/Cryptocratia/posts>/Postări</a></p></div></div></header><main class=main><div class=breadcrumbs><a href=/Cryptocratia/>Home</a>
<span class=breadcrumbs-separator>> </span><a href=/Cryptocratia/posts/>Posts</a>
<span class=breadcrumbs-separator>> </span><a class=breadcrumbs-current href=/Cryptocratia/2024/08/pkcs%2311-detalii-tehnice/>PKCS#11 – Detalii Tehnice</a></div><div class=autonumber><div class=single-intro-container><h1 class=single-title>PKCS#11 – Detalii Tehnice</h1><p class=single-summary>PKCS#11 exmple tehnice</p><p class=single-readtime><time datetime=2024-08-29T09:02:00+03:00>August 29, 2024</time>
&nbsp; · &nbsp;
3 min read</p></div><aside class=toc><p><strong>Table of contents</strong></p><nav id=TableOfContents><ul><li><a href=#inițializarea-sesiunii-cu-dispozitivul-criptografic>Inițializarea Sesiunii cu Dispozitivul Criptografic</a></li><li><a href=#generarea-cheii-private>Generarea Cheii Private</a></li><li><a href=#semnarea-unui-hash>Semnarea unui Hash</a></li><li><a href=#adâncirea-în-specificații-și-funcționalități-avansate>Adâncirea în Specificații și Funcționalități Avansate</a></li></ul></nav></aside><div class=single-content><h1 id=pkcs11--detalii-tehnice>PKCS#11 – Detalii Tehnice</h1><p>Dacă vrei să te adâncești în detaliile tehnice ale PKCS#11 și să vezi cum funcționează acest protocol în practică, acest capitol îți va oferi câteva exemple concrete. Vom explora codul și mesajele utilizate pentru operațiuni precum generarea unei chei private sau semnarea unui hash.</p><h2 id=inițializarea-sesiunii-cu-dispozitivul-criptografic>Inițializarea Sesiunii cu Dispozitivul Criptografic</h2><p>Primul pas în utilizarea PKCS#11 este inițializarea unei sesiuni cu dispozitivul criptografic (de exemplu, un HSM sau un smart card). Acest lucru se face prin conectarea la token-ul criptografic și deschiderea unei sesiuni:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span>CK_SESSION_HANDLE hSession;
</span></span><span style=display:flex><span>CK_RV rv;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#888;font-style:italic>// Inițializarea bibliotecii PKCS#11
</span></span></span><span style=display:flex><span><span style=color:#888;font-style:italic></span>rv = <span style=color:#666;font-weight:700;font-style:italic>C_Initialize</span>(NULL_PTR);
</span></span><span style=display:flex><span><span style=font-weight:700;text-decoration:underline>if</span> (rv != CKR_OK) {
</span></span><span style=display:flex><span>    <span style=color:#888;font-style:italic>// Manevrarea erorilor
</span></span></span><span style=display:flex><span><span style=color:#888;font-style:italic></span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#888;font-style:italic>// Deschiderea unei sesiuni pe token-ul criptografic
</span></span></span><span style=display:flex><span><span style=color:#888;font-style:italic></span>rv = <span style=color:#666;font-weight:700;font-style:italic>C_OpenSession</span>(slotID, CKF_SERIAL_SESSION, NULL_PTR, NULL_PTR, &amp;hSession);
</span></span><span style=display:flex><span><span style=font-weight:700;text-decoration:underline>if</span> (rv != CKR_OK) {
</span></span><span style=display:flex><span>    <span style=color:#888;font-style:italic>// Manevrarea erorilor
</span></span></span><span style=display:flex><span><span style=color:#888;font-style:italic></span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#888;font-style:italic>// Autentificarea pe token
</span></span></span><span style=display:flex><span><span style=color:#888;font-style:italic></span>rv = <span style=color:#666;font-weight:700;font-style:italic>C_Login</span>(hSession, CKU_USER, (CK_UTF8CHAR_PTR)pin, <span style=color:#666;font-weight:700;font-style:italic>strlen</span>(pin));
</span></span><span style=display:flex><span><span style=font-weight:700;text-decoration:underline>if</span> (rv != CKR_OK) {
</span></span><span style=display:flex><span>    <span style=color:#888;font-style:italic>// Manevrarea erorilor
</span></span></span><span style=display:flex><span><span style=color:#888;font-style:italic></span>}
</span></span></code></pre></div><h2 id=generarea-cheii-private>Generarea Cheii Private</h2><p>După ce sesiunea este inițializată și autentificarea este completă, se poate genera o cheie privată pe dispozitivul criptografic. PKCS#11 permite specificarea atributelor cheii, precum utilizarea acesteia pentru semnături digitale.</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span>CK_OBJECT_HANDLE hPrivateKey;
</span></span><span style=display:flex><span>CK_MECHANISM keyGenMech = { CKM_RSA_PKCS_KEY_PAIR_GEN, NULL_PTR, 0 };
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#888;font-style:italic>// Atributele cheii private
</span></span></span><span style=display:flex><span><span style=color:#888;font-style:italic></span>CK_ATTRIBUTE privateKeyTemplate[] = {
</span></span><span style=display:flex><span>    { CKA_TOKEN, &amp;<span style=font-weight:700;font-style:italic>true</span>, <span style=font-weight:700;text-decoration:underline>sizeof</span>(<span style=font-weight:700;font-style:italic>true</span>) },
</span></span><span style=display:flex><span>    { CKA_PRIVATE, &amp;<span style=font-weight:700;font-style:italic>true</span>, <span style=font-weight:700;text-decoration:underline>sizeof</span>(<span style=font-weight:700;font-style:italic>true</span>) },
</span></span><span style=display:flex><span>    { CKA_SIGN, &amp;<span style=font-weight:700;font-style:italic>true</span>, <span style=font-weight:700;text-decoration:underline>sizeof</span>(<span style=font-weight:700;font-style:italic>true</span>) }
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#888;font-style:italic>// Generarea cheii
</span></span></span><span style=display:flex><span><span style=color:#888;font-style:italic></span>rv = <span style=color:#666;font-weight:700;font-style:italic>C_GenerateKeyPair</span>(hSession, &amp;keyGenMech, publicKeyTemplate, 3, privateKeyTemplate, 3, &amp;hPublicKey, &amp;hPrivateKey);
</span></span><span style=display:flex><span><span style=font-weight:700;text-decoration:underline>if</span> (rv != CKR_OK) {
</span></span><span style=display:flex><span>    <span style=color:#888;font-style:italic>// Manevrarea erorilor
</span></span></span><span style=display:flex><span><span style=color:#888;font-style:italic></span>}
</span></span></code></pre></div><h2 id=semnarea-unui-hash>Semnarea unui Hash</h2><p>Odată ce cheia privată este generată și stocată în dispozitivul criptografic, poate fi utilizată pentru a semna hash-uri de date. Aici este un exemplu simplu de semnare a unui hash folosind PKCS#11:</p><div class=highlight><pre tabindex=0 style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span>CK_MECHANISM signMech = { CKM_SHA256_RSA_PKCS, NULL_PTR, 0 };
</span></span><span style=display:flex><span>CK_BYTE_PTR pData; <span style=color:#888;font-style:italic>// Hash-ul ce trebuie semnat
</span></span></span><span style=display:flex><span><span style=color:#888;font-style:italic></span>CK_ULONG ulDataLen; <span style=color:#888;font-style:italic>// Lungimea hash-ului
</span></span></span><span style=display:flex><span><span style=color:#888;font-style:italic></span>CK_BYTE signature[256];
</span></span><span style=display:flex><span>CK_ULONG ulSignatureLen = <span style=font-weight:700;text-decoration:underline>sizeof</span>(signature);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#888;font-style:italic>// Inițializarea operațiunii de semnare
</span></span></span><span style=display:flex><span><span style=color:#888;font-style:italic></span>rv = <span style=color:#666;font-weight:700;font-style:italic>C_SignInit</span>(hSession, &amp;signMech, hPrivateKey);
</span></span><span style=display:flex><span><span style=font-weight:700;text-decoration:underline>if</span> (rv != CKR_OK) {
</span></span><span style=display:flex><span>    <span style=color:#888;font-style:italic>// Manevrarea erorilor
</span></span></span><span style=display:flex><span><span style=color:#888;font-style:italic></span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#888;font-style:italic>// Semnarea hash-ului
</span></span></span><span style=display:flex><span><span style=color:#888;font-style:italic></span>rv = <span style=color:#666;font-weight:700;font-style:italic>C_Sign</span>(hSession, pData, ulDataLen, signature, &amp;ulSignatureLen);
</span></span><span style=display:flex><span><span style=font-weight:700;text-decoration:underline>if</span> (rv != CKR_OK) {
</span></span><span style=display:flex><span>    <span style=color:#888;font-style:italic>// Manevrarea erorilor
</span></span></span><span style=display:flex><span><span style=color:#888;font-style:italic></span>}
</span></span></code></pre></div><h2 id=adâncirea-în-specificații-și-funcționalități-avansate>Adâncirea în Specificații și Funcționalități Avansate</h2><p>PKCS#11 este un standard foarte versatil, permițând o gamă largă de operațiuni criptografice, cum ar fi criptarea/decriptarea datelor, managementul cheilor și operarea cu certificate digitale. Pentru cei care doresc să exploreze mai profund, specificațiile PKCS#11 oferă detalii complete despre fiecare funcție disponibilă, parametrii acceptați și modul în care acestea pot fi utilizate în diferite scenarii.</p><p>În aplicațiile avansate, PKCS#11 poate fi folosit pentru a interacționa cu QSCD-uri în contexte complexe, cum ar fi gestionarea semnăturilor electronice calificate sau integrarea cu sisteme de autentificare multi-factor. Este esențial să înțelegi nu doar cum să scrii codul, ci și cum să îl optimizezi pentru securitate și performanță maximă, mai ales în aplicații critice cum sunt cele guvernamentale sau financiare.</p><ul><li><a href=https://www.cryptsoft.com/pkcs11doc/>PKCS#11: Cryptographic Token Interface Standard</a></li></ul></div><div class=single-pagination><hr><div class=flex><div class=single-pagination-prev><div class=single-pagination-container-prev><div class=single-pagination-text>←</div><div class=single-pagination-text><a href=/Cryptocratia/2024/08/%C3%AEn%C8%9Belegerea-pkcs%2311-%C8%99i-qscd/>Înțelegerea PKCS#11 și QSCD</a></div></div></div><div class=single-pagination-next></div></div><hr></div><div class=back-to-top><a href=#top>back to top</a></div></div></main></div><footer><p>Powered by
<a href=https://gohugo.io/>Hugo</a>
and
<a href=https://github.com/tomfran/typo>tomfran/typo</a></p><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.css><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.js></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/auto-render.min.js onload=renderMathInElement(document.body)></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}]})})</script></footer></body><script>function isAuto(){return document.body.classList.contains("auto")}function setTheme(){if(!isAuto())return;document.body.classList.remove("auto");let e="light";window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches&&(e="dark"),document.body.classList.add(e)}function invertBody(){document.body.classList.toggle("dark"),document.body.classList.toggle("light")}isAuto()&&window.matchMedia("(prefers-color-scheme: dark)").addListener(invertBody),setTheme()</script></html>